<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´ å› æ•°åˆ†è§£ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 600px;
            width: 90%;
            text-align: center;
        }

        h1 {
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .difficulty-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .difficulty-btn.easy {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
        }

        .difficulty-btn.medium {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
            color: white;
        }

        .difficulty-btn.hard {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            color: white;
        }

        .difficulty-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .difficulty-btn.selected {
            transform: scale(1.1);
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2d3748;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #718096;
            margin-top: 5px;
        }

        .question-area {
            margin: 40px 0;
        }

        .question-number {
            font-size: 4rem;
            font-weight: bold;
            color: #4c51bf;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .input-area {
            margin: 30px 0;
        }

        #answerInput {
            width: 100%;
            max-width: 400px;
            padding: 15px;
            font-size: 1.2rem;
            border: 3px solid #e2e8f0;
            border-radius: 15px;
            text-align: center;
            outline: none;
            transition: border-color 0.3s ease;
        }

        #answerInput:focus {
            border-color: #4c51bf;
            box-shadow: 0 0 0 3px rgba(76, 81, 191, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #4c51bf, #667eea);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #718096, #4a5568);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            margin: 20px 0;
            padding: 15px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .feedback.correct {
            background: linear-gradient(45deg, #c6f6d5, #9ae6b4);
            color: #22543d;
        }

        .feedback.incorrect {
            background: linear-gradient(45deg, #fed7d7, #fbb6ce);
            color: #742a2a;
        }

        .ranking-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .rank-number {
            font-size: 1.5rem;
            font-weight: bold;
            margin-right: 20px;
            min-width: 40px;
        }

        .rank-1 { color: #d69e2e; }
        .rank-2 { color: #a0aec0; }
        .rank-3 { color: #dd6b20; }

        .player-info {
            flex: 1;
            text-align: left;
        }

        .player-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #2d3748;
        }

        .player-stats {
            font-size: 0.9rem;
            color: #718096;
        }

        .name-input {
            margin: 20px 0;
        }

        .name-input input {
            padding: 12px;
            font-size: 1.1rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            width: 250px;
            text-align: center;
        }

        .rules {
            background: linear-gradient(135deg, #ebf8ff, #bee3f8);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
        }

        .rules h3 {
            color: #2b6cb0;
            margin-bottom: 15px;
        }

        .rules ul {
            color: #2c5282;
            line-height: 1.6;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #48bb78, #38a169);
            transition: width 1s ease;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .question-number {
                font-size: 3rem;
            }
            
            .difficulty-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ§® ç´ å› æ•°åˆ†è§£ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ </h1>

        <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ -->
        <div id="menuScreen" class="screen active">
            <div class="rules">
                <h3>ğŸ“‹ ãƒ«ãƒ¼ãƒ«</h3>
                <ul>
                    <li>è¡¨ç¤ºã•ã‚ŒãŸæ•°ã‚’ç´ å› æ•°åˆ†è§£ã—ã¦ãã ã•ã„</li>
                    <li>ç­”ãˆã¯ã€Œ2 3 5ã€ã®ã‚ˆã†ã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã£ã¦å…¥åŠ›</li>
                    <li>åˆ¶é™æ™‚é–“ã¯60ç§’ã§ã™</li>
                    <li>æ­£è§£ã™ã‚‹ã¨ãƒã‚¤ãƒ³ãƒˆãŒåŠ ç®—ã•ã‚Œã¾ã™</li>
                </ul>
            </div>
            
            <p style="margin: 20px 0; color: #4a5568;">é›£æ˜“åº¦ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š</p>
            <div class="difficulty-buttons">
                <button class="difficulty-btn easy selected" data-difficulty="easy">
                    ğŸ˜Š ç°¡å˜<br><small>(4-50)</small>
                </button>
                <button class="difficulty-btn medium" data-difficulty="medium">
                    ğŸ˜ æ™®é€š<br><small>(25-200)</small>
                </button>
                <button class="difficulty-btn hard" data-difficulty="hard">
                    ğŸ˜¤ å›°é›£<br><small>(100-500)</small>
                </button>
            </div>
            
            <div>
                <button class="btn btn-primary" onclick="startGame()">ğŸ® ã‚²ãƒ¼ãƒ é–‹å§‹</button>
                <button class="btn btn-warning" onclick="showRanking()">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
            </div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div id="gameScreen" class="screen">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="timeDisplay">60</div>
                    <div class="stat-label">â° æ®‹ã‚Šæ™‚é–“</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="scoreDisplay">0</div>
                    <div class="stat-label">â­ ã‚¹ã‚³ã‚¢</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="correctDisplay">0</div>
                    <div class="stat-label">âœ… æ­£è§£æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="accuracyDisplay">0</div>
                    <div class="stat-label">ğŸ¯ æ­£ç­”ç‡(%)</div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="timeProgress"></div>
            </div>
            
            <div class="question-area">
                <p>ã“ã®æ•°ã‚’ç´ å› æ•°åˆ†è§£ã—ã¦ãã ã•ã„ï¼š</p>
                <div class="question-number" id="questionNumber">12</div>
            </div>
            
            <div class="input-area">
                <input type="text" id="answerInput" placeholder="ä¾‹: 2 2 3" maxlength="50">
                <br>
                <button class="btn btn-success" onclick="checkAnswer()">ğŸ’¡ ç­”ãˆã‚‹</button>
            </div>
            
            <div id="feedback" class="feedback" style="display: none;"></div>
            
            <div>
                <button class="btn btn-secondary" onclick="pauseGame()" id="pauseBtn">â¸ï¸ ä¸€æ™‚åœæ­¢</button>
                <button class="btn btn-danger" onclick="endGame()">ğŸ”š çµ‚äº†</button>
            </div>
        </div>

        <!-- çµæœç”»é¢ -->
        <div id="resultScreen" class="screen">
            <h2 style="color: #4c51bf; margin-bottom: 20px;">ğŸ‰ ã‚²ãƒ¼ãƒ çµ‚äº†ï¼</h2>
            
            <div class="stat-card" style="margin: 20px 0;">
                <div class="stat-number" id="finalScore">0</div>
                <div class="stat-label">æœ€çµ‚ã‚¹ã‚³ã‚¢</div>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="finalCorrect">0</div>
                    <div class="stat-label">æ­£è§£æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="finalAccuracy">0</div>
                    <div class="stat-label">æ­£ç­”ç‡(%)</div>
                </div>
            </div>
            
            <div class="name-input">
                <p>ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«è¨˜éŒ²ã—ã¾ã™ã‹ï¼Ÿ</p>
                <input type="text" id="playerName" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›" maxlength="20">
                <br>
                <button class="btn btn-warning" onclick="saveToRanking()">ğŸ“ è¨˜éŒ²ã™ã‚‹</button>
            </div>
            
            <div>
                <button class="btn btn-primary" onclick="showMenu()">ğŸ  ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
                <button class="btn btn-success" onclick="startGame()">ğŸ”„ ã‚‚ã†ä¸€åº¦</button>
            </div>
        </div>

        <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”»é¢ -->
        <div id="rankingScreen" class="screen">
            <h2 style="color: #d69e2e; margin-bottom: 20px;">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
            
            <div id="rankingList" class="ranking-list"></div>
            
            <div>
                <button class="btn btn-primary" onclick="showMenu()">ğŸ  ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
                <button class="btn btn-danger" onclick="clearRankings()">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            difficulty: 'easy',
            score: 0,
            correctAnswers: 0,
            totalQuestions: 0,
            currentNumber: 0,
            timeLeft: 60,
            gameTimer: null,
            isPaused: false
        };

        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿
        let rankings = JSON.parse(localStorage.getItem('primeFactorizationRankings') || '[]');

        // ç´ å› æ•°åˆ†è§£é–¢æ•°
        function primeFactorize(n) {
            const factors = [];
            let d = 2;
            while (d * d <= n) {
                while (n % d === 0) {
                    factors.push(d);
                    n /= d;
                }
                d++;
            }
            if (n > 1) {
                factors.push(n);
            }
            return factors;
        }

        // é›£æ˜“åº¦ã«å¿œã˜ãŸæ•°å€¤ç”Ÿæˆ
        function generateNumber(difficulty) {
            let min, max;
            switch (difficulty) {
                case 'easy': min = 4; max = 50; break;
                case 'medium': min = 25; max = 200; break;
                case 'hard': min = 100; max = 500; break;
                default: min = 4; max = 50;
            }
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // ç”»é¢è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // é›£æ˜“åº¦é¸æŠ
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                gameState.difficulty = this.dataset.difficulty;
            });
        });

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º
        function showMenu() {
            showScreen('menuScreen');
            resetGame();
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            resetGame();
            showScreen('gameScreen');
            generateNewQuestion();
            startTimer();
            document.getElementById('answerInput').focus();
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            gameState.score = 0;
            gameState.correctAnswers = 0;
            gameState.totalQuestions = 0;
            gameState.timeLeft = 60;
            gameState.isPaused = false;
            clearInterval(gameState.gameTimer);
            updateDisplay();
        }

        // æ–°ã—ã„å•é¡Œç”Ÿæˆ
        function generateNewQuestion() {
            gameState.currentNumber = generateNumber(gameState.difficulty);
            gameState.totalQuestions++;
            document.getElementById('questionNumber').textContent = gameState.currentNumber;
            document.getElementById('answerInput').value = '';
            document.getElementById('feedback').style.display = 'none';
        }

        // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
        function startTimer() {
            gameState.gameTimer = setInterval(() => {
                if (!gameState.isPaused) {
                    gameState.timeLeft--;
                    updateDisplay();
                    
                    if (gameState.timeLeft <= 0) {
                        endGame();
                    }
                }
            }, 1000);
        }

        // è¡¨ç¤ºæ›´æ–°
        function updateDisplay() {
            document.getElementById('timeDisplay').textContent = gameState.timeLeft;
            document.getElementById('scoreDisplay').textContent = gameState.score;
            document.getElementById('correctDisplay').textContent = gameState.correctAnswers;
            
            const accuracy = gameState.totalQuestions > 0 ? 
                Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100) : 0;
            document.getElementById('accuracyDisplay').textContent = accuracy;
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
            const progress = (gameState.timeLeft / 60) * 100;
            document.getElementById('timeProgress').style.width = progress + '%';
        }

        // ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯
        function checkAnswer() {
            const userInput = document.getElementById('answerInput').value.trim();
            if (!userInput) return;

            const correctFactors = primeFactorize(gameState.currentNumber);
            const userFactors = userInput.split(/\s+/).map(n => parseInt(n)).filter(n => !isNaN(n)).sort((a, b) => a - b);
            
            const isCorrect = JSON.stringify(correctFactors.sort((a, b) => a - b)) === JSON.stringify(userFactors);
            
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.style.display = 'block';
            
            if (isCorrect) {
                gameState.correctAnswers++;
                const timeBonus = Math.max(1, Math.floor(gameState.timeLeft / 10));
                const difficultyMultiplier = gameState.difficulty === 'easy' ? 1 : gameState.difficulty === 'medium' ? 2 : 3;
                const points = (10 + timeBonus) * difficultyMultiplier;
                gameState.score += points;
                
                feedbackEl.className = 'feedback correct';
                feedbackEl.textContent = `ğŸ‰ æ­£è§£ï¼ +${points}ç‚¹`;
                
                setTimeout(() => {
                    generateNewQuestion();
                }, 1500);
            } else {
                feedbackEl.className = 'feedback incorrect';
                feedbackEl.textContent = `âŒ ä¸æ­£è§£... æ­£è§£: ${correctFactors.join(' ')}`;
                
                setTimeout(() => {
                    generateNewQuestion();
                }, 3000);
            }
            
            updateDisplay();
        }

        // Enterã‚­ãƒ¼ã§ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯
        document.getElementById('answerInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        // ã‚²ãƒ¼ãƒ ä¸€æ™‚åœæ­¢
        function pauseGame() {
            gameState.isPaused = !gameState.isPaused;
            const pauseBtn = document.getElementById('pauseBtn');
            pauseBtn.textContent = gameState.isPaused ? 'â–¶ï¸ å†é–‹' : 'â¸ï¸ ä¸€æ™‚åœæ­¢';
        }

        // ã‚²ãƒ¼ãƒ çµ‚äº†
        function endGame() {
            clearInterval(gameState.gameTimer);
            
            const accuracy = gameState.totalQuestions > 0 ? 
                Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100) : 0;
            
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalCorrect').textContent = gameState.correctAnswers;
            document.getElementById('finalAccuracy').textContent = accuracy;
            
            showScreen('resultScreen');
            document.getElementById('playerName').focus();
        }

        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ä¿å­˜
        function saveToRanking() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const accuracy = gameState.totalQuestions > 0 ? 
                Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100) : 0;

            const record = {
                name: playerName,
                score: gameState.score,
                correctAnswers: gameState.correctAnswers,
                accuracy: accuracy,
                difficulty: gameState.difficulty,
                date: new Date().toLocaleDateString('ja-JP')
            };

            rankings.push(record);
            rankings.sort((a, b) => b.score - a.score);
            rankings = rankings.slice(0, 10); // ä¸Šä½10ä½ã¾ã§

            localStorage.setItem('primeFactorizationRankings', JSON.stringify(rankings));
            
            alert('ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«è¨˜éŒ²ã—ã¾ã—ãŸï¼');
            showRanking();
        }

        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
        function showRanking() {
            showScreen('rankingScreen');
            displayRankings();
        }

        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºæ›´æ–°
        function displayRankings() {
            const rankingList = document.getElementById('rankingList');
            
            if (rankings.length === 0) {
                rankingList.innerHTML = '<p style="text-align: center; color: #718096; margin: 40px 0;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            let html = '';
            rankings.forEach((record, index) => {
                const difficultyEmoji = record.difficulty === 'easy' ? 'ğŸ˜Š' : record.difficulty === 'medium' ? 'ğŸ˜' : 'ğŸ˜¤';
                const difficultyText = record.difficulty === 'easy' ? 'ç°¡å˜' : record.difficulty === 'medium' ? 'æ™®é€š' : 'å›°é›£';
                
                html += `
                    <div class="ranking-item">
                        <div class="rank-number rank-${index + 1}">${index + 1}</div>
                        <div class="player-info">
                            <div class="player-name">${record.name}</div>
                            <div class="player-stats">
                                ${difficultyEmoji} ${difficultyText} | 
                                â­ ${record.score}ç‚¹ | 
                                âœ… ${record.correctAnswers}å•æ­£è§£ | 
                                ğŸ¯ ${record.accuracy}% | 
                                ğŸ“… ${record.date}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            rankingList.innerHTML = html;
        }

        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¯ãƒªã‚¢
        function clearRankings() {
            if (confirm('ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’å…¨ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                rankings = [];
                localStorage.removeItem('primeFactorizationRankings');
                displayRankings();
            }
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åå…¥åŠ›ã§Enterã‚­ãƒ¼å¯¾å¿œ
        document.getElementById('playerName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                saveToRanking();
            }
        });

        // åˆæœŸåŒ–
        displayRankings();
    </script>
</body>
</html>